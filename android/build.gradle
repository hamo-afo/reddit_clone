buildscript {
    ext.kotlin_version = '1.7.10'
    repositories {
        google()
        mavenCentral()
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:7.3.0'
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
    }
}

allprojects {
    repositories {
        google()
        mavenCentral()
    }
}

rootProject.buildDir = '../build'
subprojects { subproject ->
    // Only set buildDir when subproject is on the same drive as root (avoids "different roots" on Windows)
    def rootBuildPath = rootProject.buildDir.toString().replace('\\', '/')
    def subprojectPath = subproject.projectDir.toString().replace('\\', '/')
    def rootDrive = rootBuildPath.contains(':') ? rootBuildPath.take(2) : rootBuildPath.split('/')[0]
    def subDrive = subprojectPath.contains(':') ? subprojectPath.take(2) : subprojectPath.split('/')[0]
    if (rootDrive == subDrive) {
        subproject.buildDir = "${rootProject.buildDir}/${subproject.name}"
    }
    subproject.evaluationDependsOn(':app')
}

tasks.register("clean", Delete) {
    delete rootProject.buildDir
}
